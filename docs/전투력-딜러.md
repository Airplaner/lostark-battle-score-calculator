로스트아크 전투력 시뮬레이터

# 전투력 공식
```
전투력 = 순수 기본 공격력 x 전투력 증가 요소 x 전투력 증가 요소 x ... x 전투력 증가 요소
```
모든 요소들은 곱연산으로 처리된다.

## 기본 공격력
플레이어의 힘, 민첩, 지능과 무기 공격력으로 인해 기본 공격력이 계산되며,
공식은 `sqrt(힘민지*무기 공격력/6)`이다.

다만 기본 공격력 중 만찬, 음식과 같은 일시적인 버프로 인해 증가한 기본 공격력은 전투력에 반영되지 않고,
전투력은 장비와 같은 성장 요소로 인해 계산된 순수한 기본 공격력에 비례한다. (이하, 순수 기본 공격력)

순수 기본 공격력은 다음 성장 요소로 인해 증가할 수 있다.
- 힘/민첩/지능
  - 방어구
    - 재련
    - 엘릭서 공용 옵션
    - 방어구 초월 단계 (7단계)
  - 모든 초월 등급 합 (126)
  - 장신구 품질
  - 전설/영웅 아바타: 힘민지 %
  - 펫 방범대: 힘민지 %

- 무기 공격력
  - 무기
    - 재련
    - 무기 초월 단계 (7단계)
  - 방어구
    - 엘릭서 공용 옵션
  - 모든 초월 등급 합 (126)
  - 방어구 엘릭서 공용 옵션
  - 장신구 연마 옵션
  - 팔찌 옵션
  - 깨달음 카르마: 무기 공격력%

- 기본 공격력 %
  - 4T 보석
  - 어빌리티 스톤

기본 공격력에는 공격력 +나 공격력 % 효과가 반영되지 않는다.
일부 팔찌 옵션 (타격시 무기 공격력 증가)들은 해당 항목에 포함되지 않는다.

## 전투 레벨
전투 레벨 70에서 전투력을 29.45% 증가시킨다.

## 무기 품질
무기 품질의 추가 피해량만큼 전투력을 증가시킨다. 무기 품질 100의 경우 30.00% 증가한다.

## 아크패시브
진화 2T-4T에 사용한 포인트 당 전투력을 0.5% 증가시키며, 에기르 5계승 기준으로 80포인트 사용가능하므로 전투력을 40% 증가한다.
깨달음에 사용한 포인트 당 전투력을 0.7% 증가시키며, 100포인트 기준으로 70% 증가시킨다.
도약에 사용한 포인트 당 전투력을 0.2% 증가시키며, 70포인트 기준으로 14% 증가시킨다.

## 카르마
진화 카르마 1랭크 당 전투력을 0.6% 증가시키며 6랭크 기준 전투력이 3.6% 증가한다. 이는 랭크당 진화형 피해가 1% 증가하는 것을 전투력에 반영하기 위함이다.

도약 카르마 1레벨 당 전투력을 0.02% 증가시키며 30레벨 기준 전투력이 0.6% 증가한다. 이는 레벨당 초각성기 피해량이 0.5% 증가하는 것을 전투력에 반영하기 위함이다. 초각성기의 딜 증가 노드를 하나도 찍지 않은 상황에서 초각성기의 딜지분을 4%로 잡은 것과 동일한 증가 수치이다.

깨달음 카르마의 랭크로 인한 깨달음 포인트는 앞서 아크패시브 항목에서 계산되고, 레벨로 인해 증가하는 무기 공격력 %는 순수 무기 공격력 항목에서 계산되기 때문에 추가로 계산하지 않는다.

## 각인
각 각인마다 전투력을 독립적으로 증가시키며, 장착한 각인에 대해서 달성한 각인서 등급과 어빌리티 스톤 장착 효과가 모두 반영된다.

조건이 없는 각인의 경우 전투력은 실제 딜 증가량과 동일하게 증가하며, 원한의 경우 아래 표와 같다.

|원한|||||
|-----|---|---|--|-|
|어빌리티스톤 레벨|0|1|2|3|
|유각 0장|18.00%|21.00%|21.75%|23.25%|
|유각 5장|18.75%|21.75%|22.25%|24.00%|
|유각 10장|19.50%|22.50%|23.25%|24.75%|
|유각 15장|20.25%|23.25%|24.00%|25.50%|
|유각 20장|21.00%|24.00%|24.75%|26.25%|

에테르 포식자는 30스택 기준이며, 아드레날린과 같은 공격력을 %로 증가시켜주는 각인은 그대로 전투력에 반영된다.

## 엘릭서 연성 추가 효과 (세트 효과)
달인 2단계와 회심 2단계는 전투력을 12% 증가시키며, 이는 엘릭서 세트 효과로 얻을 수 있는 가장 높은 수치이다. 나머지 2단계 세트 효과에 대해서는 행운 10%, 강맹 7%, 칼날 방패 8%, 선봉대 11%, 선각자 5%, 진군 2%이다. 선각자의 쿨감과 진군의 무공 에테르 또한 딜에 기여하기 때문에 전투력이 일부 증가하는 것으로 보인다.

## 엘릭서 연성 효과
각 엘릭서 연성 옵션마다 독립적으로 전투력을 증가시킨다.

엘릭서 공용 연성 효과 중 힘민지와 무기 공격력은 기본 공격력에 이미 계산되기 때문에, 이 항목에서는 공격력만 따로 반영한다.

공격력 Lv.5 (+767) 기준으로 플레이어의 기본 공격력이 14만2037이라고 가정한 딜 증가량만큼 전투력이 증가한다. 이는 현재 엔드 스펙 유저의 기본 공격력과 유사하다.

|공용 옵션|레벨|수치|전투력 증가량|
|-|-|-|-|
|공격력|3|383|0.27%|
|공격력|4|575|0.40%|
|공격력|5|767|0.54%|

어깨와 하의에 붙을 수 있는 특수 옵션들은 종류와 무관하게 모두 5레벨 기준 전투력을 2.4% 증가시킨다. 투구와 장갑의 경우에는 5레벨 기준 전투력을 1.44% 증가시킨다.

|특수 옵션|레벨|수치|전투력 증가량|
|-|-|-|-|
|보스 피해|3|1.2%|1.20%|
|보스 피해|4|1.8%|1.80%|
|보스 피해|5|2.4%|2.40%|
|치명타 피해|3|3.5%|1.20%|
|치명타 피해|4|5.25%|1.80%|
|치명타 피해|5|7%|2.40%|
|추가 피해|3|1.55%|1.20%|
|추가 피해|4|2.32%|1.80%|
|추가 피해|5|3.1%|2.40%|
|장갑 공격력%|3|0.72%|0.72%|
|장갑 공격력%|4|1.08%|1.08%|
|장갑 공격력%|5|1.44%|1.44%|
|투구 적주피%|3|0.72%|0.72%|
|투구 적주피%|4|1.08%|1.08%|
|투구 적주피%|5|1.44%|1.44%|

## 장신구 연마 효과
각 장신구 연마 효과마다 전투력을 독립적으로 증가시킨다.

장신구 공용 연마 효과 중 힘민지와 무기 공격력은 기본 공격력에 이미 계산되기 때문에, 이 항목에서는 공격력만 따로 반영한다.

공격력 +의 경우 플레이어의 기본 공격력이 14만2857이라고 가정한 딜 증가량만큼 전투력이 증가한다. 이는 현재 엔드 스펙 유저의 기본 공격력과 유사하다. (다만 엘릭서에서 기준으로 사용된 기본 공격력과는 미세한 차이가 있다.)

|공용 옵션|레벨|수치|전투력 증가량|
|-|-|-|-|
|공격력|하|80|0.0560%|
|공격력|중|195|0.1365%|
|공격력|상|390|0.2730%|


반지의 경우 많은 플레이어에게 치명타 피해량이 확실하게 더 높은 딜 증가량을 보여주지만, 치명타 피해량과 치명타 적중률 모두 상옵 기준 동일한 1.20%의 전투력을 증가시키도록 전투력 계수가 설정되어 있다.

|반지 특수 옵션|레벨|수치|전투력 증가량|
|-|-|-|-|
|치명타 적중률|하|0.40%|0.309680%|
|치명타 적중률|중|0.95%|0.735490%|
|치명타 적중률|상|1.55%|1.200010%|
|치명타 피해량|하|1.10%|0.330000%|
|치명타 피해량|중|2.40%|0.720000%|
|치명타 피해량|상|4.00%|1.200000%|

목걸이의 추가 피해는 기존 추가 피해가 30%임을 가정한 상태에서 딜 증가량만큼 전투력을 증가시킨다.

|목걸이 특수 옵션|레벨|수치|전투력 증가량|
|-|-|-|-|
|추가 피해|하|0.60%|0.46152%|
|추가 피해|중|1.60%|1.23072%|
|추가 피해|상|2.60%|1.99992%|
|적에게 주는 피해|하|0.55%|0.55%|
|적에게 주는 피해|중|1.20%|1.20%|
|적에게 주는 피해|상|2.00%|2.00%|

귀걸이의 경우 공격력 %는 수치만큼 전투력을 증가시킨다. 무기 공격력 %는 기본 공격력 항목에서 계산되어 플레이어마다 전투력 증가량이 다르다.

## 전투 스탯
치명, 특화, 신속의 특성의 합에 0.03을 곱한 수치만큼 전투력을 증가시킨다. 이는 각종 내실, 펫 효과, 팔찌 특성을 포함한 수치이며 엔드 스펙 기준 전투력을 대략 78% 증가시킨다.

팔찌 전투 특성 60으로 인한 실제 딜 증가량은 직업마다 편차가 크지만 1.5%가량 된다. 그러나 이 항목으로 인해 증가하는 전투력은 1% 남짓으로 실제 딜 증가량보다 적게 전투력이 증가한다.

## 팔찌
팔찌 특수 옵션마다 독립적으로 전투력을 증가시킨다.

팔찌의 유물, 고대의 도약 포인트 차이로 인한 전투력은 앞선 도약 포인트 항목에서 계산된다.
팔찌의 전투 특성으로 인한 전투력은 앞선 전투 스탯 항목에서 계산된다.
팔찌의 무기 공격력은 앞선 기본 공격력에서 계산된다.

상옵 기준으로 팔찌 옵션이 증가시키는 전투력은 아래와 같다.

|옵션|전투력 증가량|
|-|-|
|치적5%, 치명타 적주피 1.5%|4.5%|
|치피10%, 치명타 적주피 1.5%|4.5%|
|추피 3.5%, 대악마 피해량2.5%|4.5%|
|쿨증 2%, 적주피 5.5%|4.5%|
|적주피 3%, 무력화 적주피5%|4.0%|

무기 공격력을 증가시켜주는 옵션인 경우에는, 기본 무기 공격력 증가는 앞서 기본 공격력 항목에서 계산되지만, 버프 형식으로 추가되는 무기 공격력은 순수 기본 공격력에 영향을 주지 않는 대신 팔찌 옵션 자체만으로 전투력을 증가시킨다.

이때 무기 공격력은 플레이어의 무기 공격력이 18만4천 정도임을 가정했을 때 딜 증가량만큼 전투력을 증가시킨다. 공이속 무공과 에포 무공의 경우에는 최대 중첩 기준으로 전투력을 증가시킨다.

|무공 옵션|무공 버프만의 전투력 증가량|
|-|-|
|적중시 무공 1480, 공이속1%, 6중첩|2.40%|
|무공 9000, 체력50%이상일때 2400|0.65%|
|무공 8700, 30초마다 무공 150, 30중첩|1.21%|

아래는 나머지 옵션들이다.

|옵션|전투력|
|-|-|
|적주피 3%|3%|
|추피 4%|3.0768%|
|백어택 스킬 적주피 3.5%|2.45%|
|헤드어택 스킬 적주피 3.5%|2.45%|
|타대 스킬 적주피 3.5%|3.5%|
|치적 5%|3.5%|
|치피 10%|3.333%|

타대 스킬 팔찌 옵션은 딜 증가량만큼 전투력을 증가시키면서, 백어택 및 헤드어택 팔찌는 왜 자체적으로 70%의 지분률을 책정한 것인지 모르겠다. 동일한 치적, 치피여도 팔찌에서 챙기냐, 장신구 연마에서 챙기나 계수가 약간 다르다.


## 보석
각 보석당 독립적으로 전투력을 증가시키며, 겁화 작열 구분이나 스킬 구분은 없다.

하나의 보석을 11개 장착한 기준으로 대략적인 전투력 증가량은 아래와 같다.

|보석|순수 전투력 증가량|기본 공격력% 합|최종 전투력 증가량|직전 대비 증가량|
|-|-|-|-|-|
|6|61.94%|4.95%|69.96%||
|7|73.20%|6.6%|84.62%|+8.63%|
|8|85.16%|8.8%|101.45%|+9.11%|
|9|97.86%|11.0%|119.62%|+9.02%|
|10|119.30%|13.2%|139.25%|+8.94%|

보석 하나당 증가하는 전투력은 아래와 같다.

|티어|레벨|전투력 증가량|
|-|-|-|
|3|1|0.48%|
|3|2|0.96%|
|3|3|1.44%|
|3|4|1.92%|
|3|5|2.40%|
|3|6|2.88%|
|3|7|3.36%|
|3|8|3.84%|
|3|9|4.80%|
|3|10|6.40%|

아래는 4티어 보석이다. 다만 4티어 보석의 경우에 있는 기본 공격력 %는 순수 기본 공격력을 증가시켜 추가적으로 전투력을 증가시킨다.

|티어|레벨|전투력 증가량|
|-|-|-|
|4|1|1.28%|
|4|2|1.92%|
|4|3|2.56%|
|4|4|3.20%|
|4|5|3.84%|
|4|6|4.48%|
|4|7|5.12%|
|4|8|5.76%|
|4|9|6.40%|
|4|10|7.04%|

## 에스더

에스더 6강, 8강에서 전투력이 추가로 0.05%-1.9% 상승한다. 에스더 자체의 무기 공격력은 이미 순수 기본 공격력 항목에서 계산되며, 이 부분은 결속으로 인한 딜 증가 수치를 전투력에 반영한다. 정확한 수치는 조사하지 못했다.

## 초월 등급 합
각 부위에서 초월 등급을 21씩 달성할 수 있으며, 등급의 합에 0.01%를 곱한 만큼 전투력이 증가한다. 풀초월 126기준 전투력이 1.26% 증가한다. 이 부분은 투구 초월 효과에서 초월 등급 당 공격력이 6증가하는 옵션을 반영하는 것으로 추정되며, 특이한 점은 공격력으로 증가하는 다른 전투력 계수보다 2배 가량 높게 측정되어 있다. 최소 단위를 더 낮출 수 없어 생기는 문제로 추정된다.

이 옵션은 투구 초월 20 등급을 달성해야 활성화되지만, 활성화 되지 않은 캐릭터에도 일괄적으로 적용되는 것으로 보인다.

## 상의와 무기 초월
상의 초월 등급 합 10에서 전승자의 힘 옵션을 얻게 되고 전투력이 0.1% 증가한다. 15를 달성하게 되면 전승자의 힘이 2배로 강화되어 전투력이 0.2% 증가한다. 그리고 20을 달성하게 되면 적에게 주는 피해 1.5% 옵션을 얻게 되어 전투력이 1.7% 증가한다. 가장 높은 달성 단계 하나만 적용된다. 전승자의 힘은 전체 피해량의 0.1% 가량을 차지하도록 기획된 것을 유추할 수 있다. 전승자의 힘이 전체 딜량의 0.1%를 차지하기 위해 요구되는 DPS는 4.67억이다.

무기 초월 등급 합 5, 10, 15에서는 공격력이 800씩, 20에서는 전투력이 1125 증가한다. 이로 인한 딜 증가량을 반영하기 위해 전투력이 상승하지만, 현재 버그가 있어 초월 등급이 5~19 사이에서는 전투력이 0.56%, 20 이상인 경우 0.79% 증가한다.

정확한 기획 의도대로라면 5단계에서 0.56%, 10단계에서 1.12%, 15단계에서 1.67%, 20단계에서 2.47%가 증가해야 한다. 해당 항목에서 공격력으로 인해 증가하는 전투력 계수는 장신구 (공격력 1000당 전투력 0.7% 증가)와 동일하다.

## 카드 세트
세구빛, 암구빛 등 종류 무관 30각에서 전투력을 15% 증가시켜주며, 하위 단계의 경우 각 딜증량과 동일하게 증가시킨다.

삼두정치는 전투력을 6.5%, 세 우마르가 오리라와 플라티나의 주민들은 전투력을 8.4%증가시켜 주기 때문에, 단일 세구빛 하나보다 두 세트를 끼는 것이 전투력을 15.446%로 미세하게 더 높게 올려준다.

## 펫 방범대
추가 피해 1%를 달성하면 전투력이 0.77% 증가한다. 이는 기존 추가 피해가 30%라고 가정했을 때의 딜 증가 수치와 동일하다.


## 평가
딜 증가량을 최대한 반영하도록 구현되었지만, 반지 연마 효과와 같은 부분은 기획 의도에 맞게 수정한 부분이 있음

실제 레이드에서는 서폿과 반드시 함께 하기 때문에 기본 공격력을 증가시키는 깡공, 힘민지 등의 효율은 20% 가량 하락하지만 이를 그대로 반영하였음. 그리고 이는 기존 전투력 사이트들 또한 가진 문제이기도 함

각인마다 딜 증가량이 다르기 때문에 직업마다 달성할 수 있는 최대 전투력이 정해져있음. 다른 전투력 사이트들은 이 감성을 해결하기 위해 원한 제외 모두 저받 기준으로 치환했으나 스마게는 그렇지 않다고 판단하고 구현함

일부 스택형 옵션 (에포, 에포팔찌 등)을 모두 최대 중첩으로 가정하고 전투력에 반영하고 있음

합연산으로 이루어져서 실제 효율이 감소하는 부분들도 모두 곱연산으로 처리되고 있음

도약 포인트로 얻는 전투력이 심각하게 낮게 측정되어 있음. 60->70기준 전투력이 1.79% 증가하는데, 직업마다 다르겠지만 아무리 도약을 못 받은 직업이어도 이만큼은 아닐 것임.

깨달음의 경우 메인 노드를 찍을 수 있는지가 딜 증가량에 크게 반영되지만 전투력은 이를 고려하지 않음. 다른 사이트들은 이를 단계적으로 구분하여 구현하였음. 다만 이 부분은 선후 관계가 뒤집혔다고 생각함. 스마게는 이미 기획 단계에서 깨달음 포인트와 딜 증가량에 대한 계수를 설정해놨고, 다만 실제 구현된 메인과 사이드 노드들은 성장 체감을 위해 일부러 특정 구간에서만 딜 증가량을 늘리고 줄이는 것으로 보임
